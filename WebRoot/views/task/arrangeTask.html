<link rel="stylesheet" type="text/css" href="../../assets/js/jqueryStep/css/jquery.step.css"/>
<script src="http://www.jq22.com/jquery/jquery-1.10.2.js"></script>
<script src="../../assets/js/jqueryStep/js/jquery.step.min.js"></script>
<style>
    button {
        display: inline-block;
        padding: 6px 12px;
        font-size: 14px;
        line-height: 1.42857143;
        text-align: center;
        cursor: pointer;
        border: 1px solid transparent;
        border-radius: 4px;
        color: #fff;
        background-color: #5bc0de;
    }

    .main {
        width: 90%;
        margin: 20px auto;
    }

    #step {
        margin-bottom: 60px;
    }

    .btns {
        float: left;
    }

    .info {
        float: left;
        height: 34px;
        line-height: 34px;
        margin-left: 40px;
        font-size: 28px;
        font-weight: bold;
        color: #928787;
    }

    .info span {
        color: red;
    }
</style>


<div class="content-header">
    <h2 class="content-title">用户管理</h2>
    <span class="layui-breadcrumb">
	  <a href="#!home">首页</a>
	  <a><cite>用户管理</cite></a>
	</span>
</div>

<div>
    <div class="main">

        <form class="layui-form" action="">
            <div id="step"></div>
            <div id="taskBasicCorpus">
                <div class="layui-form-item">
                    <label class="layui-form-label">作业名称</label>
                    <div class="layui-input-block" style="width:40%;">
                        <input type="text" name="taskName" lay-verify="title" autocomplete="off" placeholder="请输入标题"
                               class="layui-input">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">所属课程</label>
                    <div class="layui-input-block" style="width:40%;">
                        <select name="cno" id="cno" lay-verify="required" lay-search="">
                        </select>
                    </div>
                </div>

                <div class="layui-form-item">
                    <label class="layui-form-label">所属章节</label>
                    <div class="layui-input-block" style="width:40%;">
                        <select name="tchapter" id="tchapter" lay-verify="required" lay-search="" multiple name="aaa">
                            <option value="">直接选择或搜索选择</option>
                            <option value="第一章">第一章</option>
                            <option value="第二章">第二章</option>
                            <option value="第三章">第三章</option>
                            <option value="第四章">第四章</option>
                            <option value="第五章">第五章</option>
                            <option value="第六章">第六章</option>
                            <option value="第七章">第七章</option>
                            <option value="第八章">第八章</option>
                        </select>
                    </div>
                </div>
                <div class="layui-form-item">
                    <div class="layui-inline">
                        <label class="layui-form-label">作业附件</label>
                        <div class="layui-input-inline">
                            <input type="file" name="appendixesFile">
                        </div>
                    </div>
                    <div class="layui-inline">
                        <label class="layui-form-label">验证日期</label>
                        <div class="layui-input-inline">
                            <input type="text" name="date" id="date" lay-verify="date" placeholder="yyyy-MM-dd"
                                   autocomplete="off" class="layui-input">
                        </div>
                    </div>
                </div>

                <div class="layui-form-item">
                    <label class="layui-form-label">开启答案功能</label>
                    <div class="layui-input-block">
                        <input type="checkbox" name="close" lay-skin="switch" lay-text="ON|OFF">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">开启消息功能</label>
                    <div class="layui-input-block">
                        <input type="checkbox" checked="" name="open" lay-skin="switch" lay-filter="switchTest"
                               lay-text="ON|OFF">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">作业类型</label>
                    <div class="layui-input-block">
                        <input type="radio" name="sex" value="题型一" title="题型一" checked="">
                        <input type="radio" name="sex" value="题型二" title="题型二">
                    </div>
                </div>
            </div>
            <div id="confirmQuestions" style="display:none">
                <div>
                    <label class="layui-form-label">题型设置</label>
                    <div style="display: inline-block;width:50%;">
                        <ul class="ul1" id="user_ul">
                        </ul>
                    </div>
                    <div id="most_tixing" style="display: inline-block;margin-right: 30%;position:absolute;left:50%;" >
                        <dl id="ddbutton">
                            <dd id="ddbutton1" style="margin-top: 10px;">
                                <input type="button" id="tixing_danxuan" class="layui-btn" value="单选题">
                                <input type="button" id="tixing_duoxuan" class="layui-btn" value="多选题">
                            </dd>
                            <dd id="ddbutton2" style="margin-top: 10px;">
                                <input type="button" id="tixing_tiankong" class="layui-btn" value="填空题">
                                <input type="button" id="tixing_panduan" class="layui-btn" value="判断题">
                            </dd>
                            <dd id="ddbutton3" style="margin-top: 10px;">
                                <input type="button" id="tixing_jianda" class="layui-btn" value="简答题">
                                <input type="button" id="tixing_daima" class="layui-btn" value="编程题">
                            </dd>
                        </dl>
                    </div>
                    <div style="margin-left: 180px">
                        <b style="font-size: 20px" id="total_score">
                        </b>
                    </div>
            </div>
            </div>
            <div id="confirmClass">
                <table width="90%" cellpadding="0" cellspacing="0" style="table-layout: fixed;margin: 0 auto">
                    <thead >
                    <tr style="margin-top: 30px">
                        <td style="margin-left: 10px" width="40px"></td>
                        <td style="margin-left: 10px">班级</td>
                        <td style="margin-left: 10px">时间</td>
                    </tr>
                    </thead>
                    <tbody id="shareTaskToClass">

                    </tbody>
                </table>
            </div>
            <div class="layui-form-item">
                <br>
                <div class="layui-input-inline">
                    <button class="layui-btn" lay-submit="" lay-filter="demo1">立即提交</button>
                    <button type="reset" class="layui-btn layui-btn-primary">重置</button>
                </div>
            </div>
            <div class="btns">
                <button id="prevBtn" type="button">上一步</button>
                <button id="nextBtn" type="button">下一步</button>
            </div>
        </form>
    </div>
</div>
<!---->
<script type="text/javascript">
    var $step = $("#step");
    var $index = $("#index");
    $step.step({
        index: 0,
        time: 500,
        title: ["填写作业信息", "选择题型", "确认班级", "完成"]
    });
    $index.text($step.getIndex());
    $("#prevBtn").on("click", function () {
        $step.prevStep();
        $("#taskBasicCorpus").css("display","");
        $("#confirmQuestions").css("display","none");
        $index.text($step.getIndex());
    });
    $("#nextBtn").on("click", function () {
        $step.nextStep();
        $("#taskBasicCorpus").css("display","none");
        $("#confirmQuestions").css("display","");
        $index.text($step.getIndex());
    });
</script>
<script>
    $("input[id^='tixing_']").each(function(index,el){
        $(this).click(function(){
            var type=el.value;
            var cno=$("#cno").val();
            var chapter=$("#tchapter").val();
            $.ajax({
                type : "POST",
                url : "jss/arrangeTask",
                data : {"type" : type, "cno" : cno, "chapter" : chapter},
                dataType : "json",
                success : function(data) {
                    num = data.value;
                    if ((num * 1) > 999) {
                        num = "999+";
                    }
                    $("#user_ul").append("<li class='li1' id='"+type+"' style='margin-top: 10px;margin-left: 5%'>"+
                    " <b class='b1' style='margin-right: 5%'>"+type+"</b>"+
                    "<span class='span1' style='margin-right: 10%'>"+num+"</span>"+
                    "<div class='div2' style='display:inline-block;margin-right: 5%'>"+
                    " <input type='number' onChange='totalscore1(this,"+num+")' name='count' onkeypress='keyPress(this)' onkeyup='keyUp(this)' onblur='onBlur(this)' name='count' value='1' style='width:40px;'>题"+
                    "</div>"+
                    "<input type='hidden' name='ampp.types' value="+index+">"+
                    "<div class='div3' style='display:inline-block;'>"+
                    "   <input type='text' onChange='totalscore2(this)' name='score' onkeypress='keyPress(this)' onkeyup='keyUp(this)' onblur='onBlur(this)' name='score' value='1' style='width:40px;'>分"+
                    "</div>"+
                    "<a class='a1' onClick='deletetixing(this)' style='cursor: pointer;' name='"+ type+"'>"+
                    "   删除"+
                    "</a>"+
                    "</li>");
                    $("#total_score").text("总分：" + totalScore());
                }
            });
            $(this).attr("disabled","false");
            $(this).attr("class","layui-btn layui-btn-disabled");
        });
    });
    function deletetixing(obj) {
        var tixing = $(obj).attr("name");
        $("#" + tixing).remove();
        console.log(tixing);
        var score=0;
        $("#ddbutton").find("input[type='button'][value="+ tixing+"]").removeAttr("disabled").attr("class","layui-btn");
        var arr1 = document.getElementsByName("count");
        if(document.getElementsByName("count").length>0){
            var tatal_score = totalScore();
            $("#total_score").text("总分：" + tatal_score);
        }else{
            $("#total_score").text("");
        }
    }
    function totalScore(){
        var arr1 = document.getElementsByName("count");
        var arr2 = document.getElementsByName("score");
        var totalScore=0;
        for(var i=0;i<arr1.length;i++){
            totalScore+=arr1[i].value *arr2[i].value;
        }
        return totalScore;
    }
    function keyPress(ob) {
        if (!ob.value.match(/^[\+\-]?\d*?\.?\d*?$/)) {
            ob.value = "0";
        }
        if (ob.value.match(/^(?:[\+\-]?\d+(?:\.\d+)?)?$/)) {
            ob.o_value = ob.value;
        }
    }
    function keyUp(ob) {
        if (!ob.value.match(/^[\+\-]?\d*?\.?\d*?$/)) {
            ob.value = ob.t_value;
        } else {
            ob.t_value = ob.value;
        }
        if (ob.value.match(/^(?:[\+\-]?\d+(?:\.\d+)?)?$/)) {
            ob.o_value = ob.value;
        }
    }
    function onBlur(ob) {
        if (!ob.value.match(/^(?:[\+\-]?\d+(?:\.\d+)?|\.\d*?)?$/)) {
            ob.value = ob.o_value;
        } else {
            if (ob.value.match(/^\.\d+$/)) {
                ob.value = 0 + ob.value;
            }
            if (ob.value.match(/^\.$/)) {
                ob.value = 0;
                ob.o_value = ob.value;
            }
        }
    }
    function totalscore1(obj, num) {
        if (num == 0) {
            obj.value = 0;
        } else if (obj.value > num) {
            obj.value = num;
        }
        var tatal_score = totalScore();
        $("#total_score").text("总分：" + tatal_score);
    }
    function totalscore2(obj) {
        var tatal_score = totalScore();
        $("#total_score").text("总分：" + tatal_score);
    }
</script>
<script type="text/javascript" src="assets/js/task/selectMultiple.js"></script>
<script>
    layui.use(['form', 'layedit', 'laydate'], function () {
        var form = layui.form
            , layer = layui.layer
            , layedit = layui.layedit
            , laydate = layui.laydate
            ,$ = layui.jquery;
        //日期
        laydate.render({
            elem: '#date'
        });
        laydate.render({
            elem: '#date1'
        });
        $("#cno").append()
        createShareTaskTable();

        createSelectCourse();
        //自定义验证规则
        form.verify({
            title: function (value) {
                if (value.length < 5) {
                    return '标题至少得5个字符啊';
                }
            }
            , pass: [/(.+){6,12}$/, '密码必须6到12位']
            , content: function (value) {
                layedit.sync(editIndex);
            }
        });

        //监听指定开关
        form.on('switch(switchTest)', function (data) {
            layer.msg('开关checked：' + (this.checked ? 'true' : 'false'), {
                offset: '6px'
            });
            layer.tips('温馨提示：请注意开关状态的文字可以随意定义，而不仅仅是ON|OFF', data.othis)
        });

        //监听提交
        form.on('submit(demo1)', function (data) {
            layer.alert(JSON.stringify(data.field), {
                title: '最终的提交信息'
            })
            return false;
        });

        form.render();
    });
    function createSelectCourse(){
        var course=getCurrentCourse();
        console.log(course);
        html='';
        for(var i=0;i<course.length;i++){
            html+="<option value='"+course[i].cid+"'>"+course[i].courseName+"</option>";
        }
        console.log(html);
        $("#cno").html(html);
    }

    function createShareTaskTable(){
        var str='';
        var clazz=getCurrentClass();
        for(var i=0;i<clazz.length;i++){
            str+= "<tr height='50px'>" +
                "<td style=\"margin-left: 10px\"><input type='checkbox' name='classNo' lay-filter='classNo' value='" + clazz[i].cno + "'></td>" +
                "<td style=\"margin-left: 10px\">" +clazz[i].cname+ "</td>" +
                "<td style=\"margin-left: 10px\">" +
                "<input type='text' style='display: none;width: 50%;' class='layui-input' id='test"+i+"' name='time' placeholder='yyyy-MM-dd HH:mm:ss'>" +
                "</td>" +
                "</tr>";
        }
        $("#shareTaskToClass").html(str);
        for(var i=0;i<clazz.length;i++){
            layui.use('laydate', function() {
                var laydate = layui.laydate;
                //时间选择器
                console.log("时间");
                laydate.render({
                    elem: '#test'+i,
                    type: 'datetime'
                });
            });
            layui.form.render();
        }
        var time=document.getElementsByName("time");
        form.on('checkbox(classNo)', function(data){
            console.log(data.elem); //得到checkbox原始DOM对象
            console.log(data.elem.checked); //是否被选中，true或者false
            console.log(data.value); //复选框value值，也可以通过data.elem.value得到
            console.log(data.othis); //得到美化后的DOM对象
            if(data.elem.checked){
                time[index].style.display='';
                time[index].value='';
            }else{
                time[index].style.display='none';
                time[index].value='';
            }
        });
        layui.form.render();
    }
</script>